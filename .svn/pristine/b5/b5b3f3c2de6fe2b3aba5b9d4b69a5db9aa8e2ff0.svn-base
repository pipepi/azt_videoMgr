<%@ page contentType="text/html; charset=UTF-8"%>
<%@ page isELIgnored="false" %>
<%@ include file="/WEB-INF/views/inc/header.jsp"%>
<c:set var="rootpath" value="${CONTEXT_PATH}/store"/>
<c:set var="ctx" value="<%=request.getContextPath() %>"/>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>新建播放器</title>
<link rel="stylesheet" href="${CSS_PATH}/store/new_style.css" />
<script src="${JS_PATH}/libs/jquery.min.js"></script>
<script type = "text/javascript" charset="utf-8" src="${ctx}/source/js/jquery.swfobject.1-1-1.js"></script>
<script type="text/javascript">
var _ctx = "${ctx}";
jQuery(document).ready(function($) {
   $(".close-icon").click(function(){
   $(".commoditys-kuang").hide();
   $(".video-kuang").hide();
  
  })
});


//发布
jQuery(document).ready(function($) {
   $(".open-btns").click(function(){
    	window.location.href = '${rootpath}/videoOffLine?eqId=' + $(this).attr('testvalue');
  })
});
//删除
jQuery(document).ready(function($) {
   $(".zhineng-sreach").click(function(){
    if(confirm('确定要删除播放器吗？')){
       window.location.href = '${rootpath}/deletestore?storeId=' + $(this).attr('testvalue');
    }
  })
});

//离线
jQuery(document).ready(function($) {
   $(".close-btns").click(function(){
       window.location.href = '${rootpath}/videoOnLine?eqId=' + $(this).attr('testvalue');
  })
});


function addPlayer(){
	
	var canAddPlayerNum=$("#canAddPlayerNum").val();
	var packagePlayerNum=$("#packagePlayerNum").val();
	var playerCount=$("#playerCount").val();
	
	
	if(canAddPlayerNum<=0){
		$("#packagelimitDesc").css("display","");
		$("#packagelimitDesc").text("可分享播放器["+playerCount+"]已达上限["+packagePlayerNum+"]");
		return;
	}

	window.location='${ctx}/store/addbfq'
}


function buyFlow(){
	
  window.location='${ctx}/package/buyflow';
  
}

function buyPackage(){
	window.location='${ctx}/package/buypackagelist';
}

</script>
</head>

<body>
 <div class="container-fluid">
      <div class="video-add">
         <div class="video-add-title">
         	<ul>
            	<li class="current">播放器列表</li>
                <li onclick = "addPlayer()">添加新播放器</li>
                <li><span id="packagelimitDesc" style="display: none;color: #e3393c;"></span></li>
                
            </ul>
         </div>
      </div>
      <div class="video-tabs"><!--video-tabs Begin-->
               
                 <div class="video-tabs-cons">
               <div class="video-add-cons" >
                <ul class="bfq-tab">
                    <li style="margin-top:4px; float:left;margin-left:20px;">已建立播放器数量<div style="font-size:24px; text-align:center;margin-top:10px;color:#e3393c;">${playerCount }</div></li>
                    <li style="margin-left:50px; width:690px;">
                     <ul>
                    	<li> <div style="padding-top:4px; float:left; color:#666666;"><strong style="color:#333333;font-size:16px;float:left">当前套餐使用情况</strong>
                    	<div style="width:452px; float:left;margin-left:9px;">&nbsp;播放器：<span>${playerCount }/${packageInfo.playerNum }</span>
                    	 &nbsp;视频： <span>${storeVideoCount}/${totalVideoNum }</span> &nbsp;产品：<span>${storeProductCount}/${totalProductNum }</span> &nbsp;有效期至：${packageEndTime}
                    	 </div>
                    	 </div>
                    	 <a href="javascript:buyPackage();" class="taocan-xy">套餐续约</a> </li>
                        <li> <div style="padding-top:5px; float:left; color:#666666;"><strong style="color:#333333;font-size:16px;">当前流量使用情况</strong></div>
                        <div class="bf-list-jdt"><div class="bf-list-jdt-cons" style="width:${flowUseRate}%;"></div><div class="bf-liu-font">${usedFlowNum}G/${totalFlowNum} G</div></div><div style="float:left; margin-top:7px;margin-left:5px; color:#666666;">&nbsp;</div><a href="javascript:buyFlow();" class="goumai-ll">购买流量</a> </li>
                    </ul>
                   </li>
                </ul>
                <div class="clear"></div>
               </div>
               
   
            <div class="voideo-add2"><!--voideo-add2 Begin-->
            <!--视频弹出框-->
            <div id = "video-list" class="commodity-kuang video-kuang" style="display:none">
                 
            </div>
            <div id = "video-yulan" style="position:absolute;background-color:#269fde;width:768px;height:550px; z-index:1000;left:14%;top:10%; display:none;">
	              <div style = "position: absolute;right:0;top:0;"><a href="javascript:void(0);" onclick="closePreView()" class="close-icon"></a></div>
	              <div id = "yulan" class="video-yulan" ></div>
            </div>  
            
              <!--商品弹出框-->
              <div id="product-list" class="commodity-kuang commoditys-kuang" style="display:none" >
              </div>
              <div class="video-add-cons">
              <input type="hidden" value="${canAddPlayerNum}" id="canAddPlayerNum"></input>
              <input type="hidden" value="${packagePlayerNum}" id="packagePlayerNum"></input>
              <input type="hidden" value="${playerCount}" id="playerCount"></input>
               <ul class="bfq-listInfors">
                 <c:forEach items="${storelist }" var="store" varStatus="status">
               	 <li>
               	 
                   <div class="bf-lists"><img
                    src="<c:choose><c:when test="${store.logoUrl!=null }">${imgpre }${store.logoUrl }</c:when><c:otherwise>${ctx }/source/images/aztimg/logo.jpg</c:otherwise></c:choose>" 
                   	onerror='this.src="${ctx }/source/images/aztimg/logo.jpg"' 
                    title="${store.description }" width="210px" height="126px" /><br/>
                   <em title="${store.name }" 
                    style="height:20px;width: 215px;overflow: hidden;text-overflow:ellipsis;white-space: nowrap;">${store.name }</em>
                   </div>
                   <div class="bf-edit"  style="width:460px;margin-left:80px;">
                     <a href="javascript:window.location='${ctx}/store/editStore?storeId=${store.id }'" class="bfq-bjBtns" style="margin-left:20px;">编辑</a>
                     <a href="javascript:preView(${store.id})" class="bfq-bjBtns" >预览</a>
                     <a href="javascript:showLinkProductPage(${store.id})" class="bfq-cpBtns" id="link-product-a-${store.id}"  linked-product-ids = "${store.linkedProductIds==null?'':store.linkedProductIds }" >关联产品</a>
                     <a href="javascript:showLinkVideoPage(${store.id})" class="bfq-spBtns" id="link-video-a-${store.id}" linked-video-ids = "${store.linkedVideoIds==null?'':store.linkedVideoIds }">关联视频</a>
                     <div class="bfq-time">最后编辑于：<fmt:formatDate value="${store.createTime }" pattern="yyyy年MM月dd日"/>
                                           已关联商品：<span id = "linked-num2-span-${store.id}"><strong>${store.linkedProductNum }</strong></span> 个/ 
                                           已关联视频：<span id = "linked-num-span-${store.id}"><strong>${store.linkedVideoNum }</strong></span> 个   </div>
                   </div>
                   
                   <div style="padding-top:40px;float:right;margin-right: 70px;"><a href="javascript:void(0)"  class="zhineng-sreach" testvalue="${ store.id }">删除</a></div>
                 </li>
                 </c:forEach>
                 <div class="clear"></div>
               </ul>
              </div>
            </div><!--voideo-add2 End-->
           </div>
   
        </div><!--video-tabs End-->
   </div>
<script type="text/javascript" src="${ctx}/source/js/store/link_video.js"></script>
<script type="text/javascript" src="${ctx}/source/js/store/link_product.js"></script>
<script type="text/javascript">
var _user_id = "${userId}";
var _player = 0;
var _linked_videoids_arr = new Array();
var _linked_productids_arr = new Array();
var vids = "";
var pids = "";
initProductList();
loadVideoList();
function preView(id){
	var p_num = $('#linked-num2-span-'+id).find('strong').html();
	var v_num = $('#linked-num-span-'+id).find('strong').html();
	if(p_num=="0"||v_num=="0"){
		alert("请关联视频和产品");
		return;
	}
	//tmp todo
	//id = 2
	$('#video-yulan').toggle();
	$("div#yulan").flash(
	    {
	      swf:_ctx+"/source/swf/YPPlayer.swf",
	      width:768,
	      height:550,
	      allowFullScreenInteractive:true,
	      wmode: 'opaque',
	      flashvars:{ 
	    	storeId:id,
	    	userId:_user_id
	      }
	    }
    );
}	
function closePreView(){
	$('#video-yulan').toggle();
	$("div#yulan").flash().remove();
}
</script>
</body>
</html>
